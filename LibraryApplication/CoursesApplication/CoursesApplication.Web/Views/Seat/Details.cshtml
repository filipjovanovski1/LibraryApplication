@* @model CoursesApplication.Domain.DomainModels.Seat
@{
    ViewData["Title"] = "Seat Details";
}

<h2>Seat Details</h2>

<dl class="row">
    <dt class="col-sm-2">Number</dt>
    <dd class="col-sm-10">@Model.Number</dd>

    <dt class="col-sm-2">Classroom</dt>
    <dd class="col-sm-10">@Model.Classroom.Location @Model.Classroom.Name</dd>

    <dt class="col-sm-2">Status</dt>
    <dd class="col-sm-10">
        @if (Model.IsTaken && Model.TakenSeat != null && Model.TakenSeat.User != null)
        {
            <span class="text-danger">Taken by @Model.TakenSeat.User.Name @Model.TakenSeat.User.Surname</span>
        }
        else
        {
            <span class="text-success">Free</span>
        }
    </dd>
</dl>

<h3>Seat Logs</h3>
@if (Model.SeatLogs != null && Model.SeatLogs.Any())
{
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>#</th>
                <th>User</th>
                <th>Started At</th>
                <th>Freed At</th>
                <th>Reason</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var log in Model.SeatLogs.OrderByDescending(l => l.StartedAt))
            {
                <tr>
                    <td>@log.Id</td>
                    <td>@log.User.Name @log.User.Surname</td>
                    <td>@log.StartedAt.ToString("g")</td>
                    <td>@log.FreedAt.ToString("g")</td>
                    <td>@(string.IsNullOrEmpty(log.Reason) ? "-" : log.Reason)</td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>No logs available for this seat.</p>
}

<a asp-controller="Classroom"
   asp-action="Details"
   asp-route-id="@Model.Classroom?.Id"
   class="btn btn-secondary">
    Back to classroom
</a>
 *@
@model CoursesApplication.Domain.DomainModels.Seat
@{
    ViewData["Title"] = "Seat Details";
    var isTaken = Model.IsTaken && Model.TakenSeat != null && Model.TakenSeat.User != null;
}
<div class="container py-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Home</a></li>
            <li class="breadcrumb-item"><a asp-controller="Classroom" asp-action="Index">Classrooms</a></li>
            <li class="breadcrumb-item active" aria-current="page">Seat Details</li>
        </ol>
    </nav>

    <div class="card shadow-sm mb-4">
        <div class="card-header d-flex justify-content-between align-items-center bg-info text-white">
            <h5 class="mb-0">Seat Details</h5>
            <span class="badge @(isTaken ? "bg-danger" : "bg-success")">
                @(isTaken ? "Taken" : "Free")
            </span>
        </div>
        <div class="card-body">
            <dl class="row mb-0">
                <dt class="col-sm-3">Number</dt>
                <dd class="col-sm-9">@Model.Number</dd>

                <dt class="col-sm-3">Classroom</dt>
                <dd class="col-sm-9">@Model.Classroom?.Location @Model.Classroom?.Name</dd>

                <dt class="col-sm-3">Status</dt>
                <dd class="col-sm-9">
                    @if (isTaken)
                    {
                        <span class="text-danger">
                            Taken by @Model.TakenSeat!.User!.Name @Model.TakenSeat!.User!.Surname
                        </span>
                    }
                    else
                    {
                        <span class="text-success">Free</span>
                    }
                </dd>
            </dl>
        </div>
        <div class="card-footer d-flex gap-2">
            <a asp-controller="Classroom" asp-action="Details" asp-route-id="@Model.Classroom?.Id" class="btn btn-outline-secondary">Back to classroom</a>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-light">
            <h6 class="mb-0">Seat Logs (@(Model.SeatLogs?.Count() ?? 0))</h6>
        </div>
        <div class="card-body">
            @if (Model.SeatLogs != null && Model.SeatLogs.Any())
            {
                <div class="table-responsive">
                    <table class="table table-striped table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>#</th>
                                <th>User</th>
                                <th>Started At</th>
                                <th>Freed At</th>
                                <th>Reason</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var log in Model.SeatLogs.OrderByDescending(l => l.StartedAt))
                            {
                                <tr>
                                    <td>@log.Id</td>
                                    <td>@($"{log.User?.Name} {log.User?.Surname}")</td>
                                    <td>@log.StartedAt.ToString("yyyy-MM-dd HH:mm")</td>
                                    <td>@(log.FreedAt.ToString("yyyy-MM-dd HH:mm") ?? "—")</td>
                                    <td>@(string.IsNullOrEmpty(log.Reason) ? "—" : log.Reason)</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <p class="text-muted mb-0">No logs available for this seat.</p>
            }
        </div>
    </div>
</div>
